{
    "sourceFile": "app/Http/Controllers/Main/PeminjamanRuangController.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 7,
            "patches": [
                {
                    "date": 1704833040949,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1704833259585,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,9 +23,9 @@\n                 ->get();\n             $data['result'] = $user->sortDesc();\n             return view('main.peminjaman_ruang.index', $data);\n         } else {\n-            $data['title'] = 'Data pengajuan peminjaman ruang';\n+            $data['title'] = 'Data pengajuan peminjaman mobil';\n             $user = PeminjamanRuang::with('users', 'ruang')\n                 ->get();\n             $data['result'] = $user->sortDesc();\n             return view('main.peminjaman_ruang.index', $data);\n@@ -37,10 +37,10 @@\n      */\n     public function create()\n     {\n         $data['user'] = User::all();\n-        $data['ruang'] = Ruang::where('status', 1)->get();\n-        $data['peminjaman_ruang'] = PeminjamanRuang::all();\n+        $data['ruang'] = Ruang::all();\n+        $data['ruang'] = PeminjamanRuang::all();\n         $data['title'] = \"Tambah Data Peminjaman Ruang\";\n         return view(\"main.peminjaman_ruang.create\", $data);\n     }\n \n@@ -81,10 +81,8 @@\n             'tanggal' => $request->tanggal,\n             'status' => $request->status,\n         ]);\n \n-        Ruang::where('id', $request->ruang_id)->update(['status' => 0]);\n-\n         return redirect('main/peminjaman_ruang')->with('success', 'Data berhasil disimpan!');\n     }\n \n     /**\n@@ -123,12 +121,8 @@\n     public function update(Request $request, string $id)\n     {\n         $row = PeminjamanRuang::find($id);\n         if ($row) {\n-            if ($row->ruang_id != $request->ruang_id) {\n-                Ruang::where('id', $row->ruang_id)->update(['status' => 1]);\n-                Ruang::where('id', $request->ruang_id)->update(['status' => 0]);\n-            }\n             $row->user_id = $request->user_id;\n             $row->ruang_id = $request->ruang_id;\n             $row->kegiatan = $request->kegiatan;\n             $row->mulai = $request->mulai;\n@@ -136,11 +130,9 @@\n             $row->tanggal = $request->tanggal;\n             $row->status = $request->status;\n \n             $row->save();\n-            if ($row->status != 'pending') {\n-                Ruang::where('id', $request->ruang_id)->update(['status' => 1]);\n-            }\n+\n             return redirect('main/peminjaman_ruang')->with('success', 'Data berhasil diubah');\n         }\n     }\n \n@@ -149,9 +141,9 @@\n      */\n     public function destroy(string $id)\n     {\n         $data = PeminjamanRuang::findOrFail($id);\n-        Ruang::where('id', $data->ruang_id)->update(['status' => 1]);\n+\n         $data->delete();\n         return back()->with('hapus', 'Data sudah di Hapus!');\n     }\n }\n"
                },
                {
                    "date": 1704837216741,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,149 @@\n+<?php\n+\n+namespace App\\Http\\Controllers\\Main;\n+\n+use App\\Http\\Controllers\\Controller;\n+use App\\Models\\Ruang;\n+use App\\Models\\PeminjamanRuang;\n+use App\\Models\\User;\n+use Illuminate\\Http\\Request;\n+\n+class PeminjamanRuangController extends Controller\n+{\n+    /**\n+     * Display a listing of the resource.\n+     */\n+    public function index()\n+    {\n+        if ($user = auth()->user()->jab_id == 4) {\n+            $user = auth()->user()->id;\n+            $data['title'] = 'Data pengajuan peminjaman ruang';\n+            $user = PeminjamanRuang::with('users', 'ruang')\n+                ->where('user_id', $user)\n+                ->get();\n+            $data['result'] = $user->sortDesc();\n+            return view('main.peminjaman_ruang.index', $data);\n+        } else {\n+            $data['title'] = 'Data pengajuan peminjaman ruang';\n+            $user = PeminjamanRuang::with('users', 'ruang')\n+                ->get();\n+            $data['result'] = $user->sortDesc();\n+            return view('main.peminjaman_ruang.index', $data);\n+        }\n+    }\n+\n+    /**\n+     * Show the form for creating a new resource.\n+     */\n+    public function create()\n+    {\n+        $data['user'] = User::all();\n+        $data['ruang'] = Ruang::all();\n+        $data['ruang'] = PeminjamanRuang::all();\n+        $data['title'] = \"Tambah Data Peminjaman Ruang\";\n+        return view(\"main.peminjaman_ruang.create\", $data);\n+    }\n+\n+    /**\n+     * Store a newly created resource in storage.\n+     */\n+    public function store(Request $request)\n+    {\n+        $validasi = $this->validate(\n+            $request,\n+            [\n+                'user_id' => 'required',\n+                'ruang_id' => 'required',\n+                'kegiatan' => 'required',\n+                'mulai' => 'required',\n+                'selesai' => 'required',\n+                'tanggal' => 'required',\n+                'status' => 'required',\n+\n+            ],\n+            [\n+                'user_id.required' => 'user_id produk tidak boleh kosong',\n+                'ruang_id.required' => 'ruang_id tidak boleh kosong',\n+                'kegiatan.required' => 'kegiatan tidak boleh kosong',\n+                'mulai.required' => 'mulai tidak boleh kosong',\n+                'selesai.required' => 'selesai tidak boleh kosong',\n+                'tanggal.required' => 'tanggal tidak boleh kosong',\n+                'status.required' => 'status tidak boleh kosong',\n+            ]\n+        );\n+\n+        PeminjamanRuang::create([\n+            'user_id' => $request->user_id,\n+            'ruang_id' => $request->ruang_id,\n+            'kegiatan' => $request->kegiatan,\n+            'mulai' => $request->mulai,\n+            'selesai' => $request->selesai,\n+            'tanggal' => $request->tanggal,\n+            'status' => $request->status,\n+        ]);\n+\n+        return redirect('main/peminjaman_ruang')->with('success', 'Data berhasil disimpan!');\n+    }\n+\n+    /**\n+     * Display the specified resource.\n+     */\n+    public function show(string $id)\n+    {\n+        //\n+    }\n+\n+    /**\n+     * Show the form for editing the specified resource.\n+     */\n+    public function edit(string $id)\n+    {\n+        $row = PeminjamanRuang::findOrFail($id);\n+        $user = User::all();\n+        $ruang = Ruang::all();\n+        return view('main.peminjaman_ruang.edit', [\n+            'title' => 'Edit Data Pengajuan Peminjaman Ruang',\n+            'user' => $user,\n+            'id' => $row->id,\n+            'nama' => $row->nama,\n+            'ruang' => $ruang,\n+            'kegiatan' => $row->kegiatan,\n+            'mulai' => $row->mulai,\n+            'selesai' => $row->selesai,\n+            'tanggal' => $row->tanggal,\n+            'status' => $row->status,\n+        ]);\n+    }\n+\n+    /**\n+     * Update the specified resource in storage.\n+     */\n+    public function update(Request $request, string $id)\n+    {\n+        $row = PeminjamanRuang::find($id);\n+        if ($row) {\n+            $row->user_id = $request->user_id;\n+            $row->ruang_id = $request->ruang_id;\n+            $row->kegiatan = $request->kegiatan;\n+            $row->mulai = $request->mulai;\n+            $row->selesai = $request->selesai;\n+            $row->tanggal = $request->tanggal;\n+            $row->status = $request->status;\n+\n+            $row->save();\n+\n+            return redirect('main/peminjaman_ruang')->with('success', 'Data berhasil diubah');\n+        }\n+    }\n+\n+    /**\n+     * Remove the specified resource from storage.\n+     */\n+    public function destroy(string $id)\n+    {\n+        $data = PeminjamanRuang::findOrFail($id);\n+\n+        $data->delete();\n+        return back()->with('hapus', 'Data sudah di Hapus!');\n+    }\n+}\n"
                },
                {
                    "date": 1704846166741,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -14,23 +14,12 @@\n      * Display a listing of the resource.\n      */\n     public function index()\n     {\n-        if ($user = auth()->user()->jab_id == 4) {\n-            $user = auth()->user()->id;\n-            $data['title'] = 'Data pengajuan peminjaman ruang';\n-            $user = PeminjamanRuang::with('users', 'ruang')\n-                ->where('user_id', $user)\n-                ->get();\n-            $data['result'] = $user->sortDesc();\n-            return view('main.peminjaman_ruang.index', $data);\n-        } else {\n-            $data['title'] = 'Data pengajuan peminjaman ruang';\n-            $user = PeminjamanRuang::with('users', 'ruang')\n-                ->get();\n-            $data['result'] = $user->sortDesc();\n-            return view('main.peminjaman_ruang.index', $data);\n-        }\n+        $data['title'] = 'Laporan Peminjaman Ruang';\n+        $peminjaman_ruang = PeminjamanRuang::with('users')->get();\n+        $data['result'] = $peminjaman_ruang->sortDesc();\n+        return view('main.peminjaman_ruang.index', $data);\n     }\n \n     /**\n      * Show the form for creating a new resource.\n"
                },
                {
                    "date": 1704846223939,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -14,12 +14,23 @@\n      * Display a listing of the resource.\n      */\n     public function index()\n     {\n-        $data['title'] = 'Laporan Peminjaman Ruang';\n-        $peminjaman_ruang = PeminjamanRuang::with('users')->get();\n-        $data['result'] = $peminjaman_ruang->sortDesc();\n-        return view('main.peminjaman_ruang.index', $data);\n+        if ($user = auth()->user()->jab_id == 4) {\n+            $user = auth()->user()->id;\n+            $data['title'] = 'Data pengajuan peminjaman ruang';\n+            $user = PeminjamanRuang::with('users', 'ruang')\n+                ->where('user_id', $user)\n+                ->get();\n+            $data['result'] = $user->sortDesc();\n+            return view('main.peminjaman_ruang.index', $data);\n+        } else {\n+            $data['title'] = 'Data pengajuan peminjaman ruang';\n+            $user = PeminjamanRuang::with('users', 'ruang')\n+                ->get();\n+            $data['result'] = $user->sortDesc();\n+            return view('main.peminjaman_ruang.index', $data);\n+        }\n     }\n \n     /**\n      * Show the form for creating a new resource.\n"
                },
                {
                    "date": 1704846565206,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,8 +6,9 @@\n use App\\Models\\Ruang;\n use App\\Models\\PeminjamanRuang;\n use App\\Models\\User;\n use Illuminate\\Http\\Request;\n+use Illuminate\\Support\\Facades\\DB as FacadesDB;\n \n class PeminjamanRuangController extends Controller\n {\n     /**\n@@ -145,5 +146,31 @@\n \n         $data->delete();\n         return back()->with('hapus', 'Data sudah di Hapus!');\n     }\n+\n+    public function print(Request $request)\n+    {\n+        $validasi = $this->validate(\n+            $request,\n+            [\n+                'tgl_a' => 'required',\n+                'tgl_b' => 'required',\n+            ],\n+            [\n+                'tgl_a.required' => 'tanggal tidak boleh kosong',\n+                'tgl_b.required' => 'tanggal tidak boleh kosong',\n+            ]\n+        );\n+        $tgl_a = $request->tgl_a;\n+        $tgl_b = $request->tgl_b;\n+\n+        $row = PeminjamanRuang::whereBetween(FacadesDB::raw(\"DATE_FORMAT(created_at,'%Y-%m-%d')\"), [$tgl_a, $tgl_b])->get();;\n+        return view('main.peminjaman_ruang.print', [\n+            'title' => 'Laporan Data Peminjaman Ruang',\n+            'result' => $row,\n+            'tgl_a' => $tgl_a,\n+            'tgl_b' => $tgl_b,\n+        ]);\n+    }\n+\n }\n"
                },
                {
                    "date": 1704847907702,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -146,30 +146,5 @@\n \n         $data->delete();\n         return back()->with('hapus', 'Data sudah di Hapus!');\n     }\n-\n-    public function print(Request $request)\n-    {\n-        $validasi = $this->validate(\n-            $request,\n-            [\n-                'tgl_a' => 'required',\n-                'tgl_b' => 'required',\n-            ],\n-            [\n-                'tgl_a.required' => 'tanggal tidak boleh kosong',\n-                'tgl_b.required' => 'tanggal tidak boleh kosong',\n-            ]\n-        );\n-        $tgl_a = $request->tgl_a;\n-        $tgl_b = $request->tgl_b;\n-\n-        $row = PeminjamanRuang::whereBetween(FacadesDB::raw(\"DATE_FORMAT(created_at,'%Y-%m-%d')\"), [$tgl_a, $tgl_b])->get();;\n-        return view('main.peminjaman_ruang.print', [\n-            'title' => 'Laporan Data Peminjaman Ruang',\n-            'result' => $row,\n-            'tgl_a' => $tgl_a,\n-            'tgl_b' => $tgl_b,\n-        ]);\n-    }\n }\n"
                },
                {
                    "date": 1705025155613,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -17,16 +17,16 @@\n     public function index()\n     {\n         if ($user = auth()->user()->jab_id == 4) {\n             $user = auth()->user()->id;\n-            $data['title'] = 'Data pengajuan peminjaman ruang';\n+            $data['title'] = 'Data pengajuan ruang';\n             $user = PeminjamanRuang::with('users', 'ruang')\n                 ->where('user_id', $user)\n                 ->get();\n             $data['result'] = $user->sortDesc();\n             return view('main.peminjaman_ruang.index', $data);\n         } else {\n-            $data['title'] = 'Data pengajuan peminjaman ruang';\n+            $data['title'] = 'Data pengajuan ruang';\n             $user = PeminjamanRuang::with('users', 'ruang')\n                 ->get();\n             $data['result'] = $user->sortDesc();\n             return view('main.peminjaman_ruang.index', $data);\n@@ -40,9 +40,9 @@\n     {\n         $data['user'] = User::all();\n         $data['ruang'] = Ruang::all();\n         $data['peminjaman_ruang'] = PeminjamanRuang::all();\n-        $data['title'] = \"Tambah Data Peminjaman Ruang\";\n+        $data['title'] = \"Tambah Data Ruang\";\n         return view(\"main.peminjaman_ruang.create\", $data);\n     }\n \n     /**\n@@ -102,9 +102,9 @@\n         $row = PeminjamanRuang::findOrFail($id);\n         $user = User::all();\n         $ruang = Ruang::all();\n         return view('main.peminjaman_ruang.edit', [\n-            'title' => 'Edit Data Pengajuan Peminjaman Ruang',\n+            'title' => 'Edit Data Pengajuan Ruang',\n             'user' => $user,\n             'id' => $row->id,\n             'ruang' => $ruang,\n             'kegiatan' => $row->kegiatan,\n"
                }
            ],
            "date": 1704833040949,
            "name": "Commit-0",
            "content": "<?php\n\nnamespace App\\Http\\Controllers\\Main;\n\nuse App\\Http\\Controllers\\Controller;\nuse App\\Models\\Ruang;\nuse App\\Models\\PeminjamanRuang;\nuse App\\Models\\User;\nuse Illuminate\\Http\\Request;\n\nclass PeminjamanRuangController extends Controller\n{\n    /**\n     * Display a listing of the resource.\n     */\n    public function index()\n    {\n        if ($user = auth()->user()->jab_id == 4) {\n            $user = auth()->user()->id;\n            $data['title'] = 'Data pengajuan peminjaman ruang';\n            $user = PeminjamanRuang::with('users', 'ruang')\n                ->where('user_id', $user)\n                ->get();\n            $data['result'] = $user->sortDesc();\n            return view('main.peminjaman_ruang.index', $data);\n        } else {\n            $data['title'] = 'Data pengajuan peminjaman ruang';\n            $user = PeminjamanRuang::with('users', 'ruang')\n                ->get();\n            $data['result'] = $user->sortDesc();\n            return view('main.peminjaman_ruang.index', $data);\n        }\n    }\n\n    /**\n     * Show the form for creating a new resource.\n     */\n    public function create()\n    {\n        $data['user'] = User::all();\n        $data['ruang'] = Ruang::where('status', 1)->get();\n        $data['peminjaman_ruang'] = PeminjamanRuang::all();\n        $data['title'] = \"Tambah Data Peminjaman Ruang\";\n        return view(\"main.peminjaman_ruang.create\", $data);\n    }\n\n    /**\n     * Store a newly created resource in storage.\n     */\n    public function store(Request $request)\n    {\n        $validasi = $this->validate(\n            $request,\n            [\n                'user_id' => 'required',\n                'ruang_id' => 'required',\n                'kegiatan' => 'required',\n                'mulai' => 'required',\n                'selesai' => 'required',\n                'tanggal' => 'required',\n                'status' => 'required',\n\n            ],\n            [\n                'user_id.required' => 'user_id produk tidak boleh kosong',\n                'ruang_id.required' => 'ruang_id tidak boleh kosong',\n                'kegiatan.required' => 'kegiatan tidak boleh kosong',\n                'mulai.required' => 'mulai tidak boleh kosong',\n                'selesai.required' => 'selesai tidak boleh kosong',\n                'tanggal.required' => 'tanggal tidak boleh kosong',\n                'status.required' => 'status tidak boleh kosong',\n            ]\n        );\n\n        PeminjamanRuang::create([\n            'user_id' => $request->user_id,\n            'ruang_id' => $request->ruang_id,\n            'kegiatan' => $request->kegiatan,\n            'mulai' => $request->mulai,\n            'selesai' => $request->selesai,\n            'tanggal' => $request->tanggal,\n            'status' => $request->status,\n        ]);\n\n        Ruang::where('id', $request->ruang_id)->update(['status' => 0]);\n\n        return redirect('main/peminjaman_ruang')->with('success', 'Data berhasil disimpan!');\n    }\n\n    /**\n     * Display the specified resource.\n     */\n    public function show(string $id)\n    {\n        //\n    }\n\n    /**\n     * Show the form for editing the specified resource.\n     */\n    public function edit(string $id)\n    {\n        $row = PeminjamanRuang::findOrFail($id);\n        $user = User::all();\n        $ruang = Ruang::all();\n        return view('main.peminjaman_ruang.edit', [\n            'title' => 'Edit Data Pengajuan Peminjaman Ruang',\n            'user' => $user,\n            'id' => $row->id,\n            'nama' => $row->nama,\n            'ruang' => $ruang,\n            'kegiatan' => $row->kegiatan,\n            'mulai' => $row->mulai,\n            'selesai' => $row->selesai,\n            'tanggal' => $row->tanggal,\n            'status' => $row->status,\n        ]);\n    }\n\n    /**\n     * Update the specified resource in storage.\n     */\n    public function update(Request $request, string $id)\n    {\n        $row = PeminjamanRuang::find($id);\n        if ($row) {\n            if ($row->ruang_id != $request->ruang_id) {\n                Ruang::where('id', $row->ruang_id)->update(['status' => 1]);\n                Ruang::where('id', $request->ruang_id)->update(['status' => 0]);\n            }\n            $row->user_id = $request->user_id;\n            $row->ruang_id = $request->ruang_id;\n            $row->kegiatan = $request->kegiatan;\n            $row->mulai = $request->mulai;\n            $row->selesai = $request->selesai;\n            $row->tanggal = $request->tanggal;\n            $row->status = $request->status;\n\n            $row->save();\n            if ($row->status != 'pending') {\n                Ruang::where('id', $request->ruang_id)->update(['status' => 1]);\n            }\n            return redirect('main/peminjaman_ruang')->with('success', 'Data berhasil diubah');\n        }\n    }\n\n    /**\n     * Remove the specified resource from storage.\n     */\n    public function destroy(string $id)\n    {\n        $data = PeminjamanRuang::findOrFail($id);\n        Ruang::where('id', $data->ruang_id)->update(['status' => 1]);\n        $data->delete();\n        return back()->with('hapus', 'Data sudah di Hapus!');\n    }\n}\n"
        }
    ]
}