{
    "sourceFile": "app/Http/Controllers/Main/PembelianSarprasController.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1705405627883,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1705405627883,
            "name": "Commit-0",
            "content": "<?php\n\nnamespace App\\Http\\Controllers\\Main;\n\nuse App\\Http\\Controllers\\Controller;\nuse App\\Models\\JenisKebutuhan;\nuse App\\Models\\PembelianSarpras;\nuse App\\Models\\User;\nuse Faker\\Core\\File;\nuse Illuminate\\Http\\Request;\n\nclass PembelianSarprasController extends Controller\n{\n    /**\n     * Display a listing of the resource.\n     */\n    public function index()\n    {\n        if ($user = auth()->user()->jab_id == 4) {\n            $user = auth()->user()->id;\n            $data['title'] = 'Data Pembelian Sarpras';\n            $user = PembelianSarpras::with('users', 'jenis_kebutuhans')\n                ->where('user_id', $user)\n                ->get();\n            $data['result'] = $user->sortDesc();\n            return view('main.pembelian_sarpras.index', $data);\n        } else {\n            $data['title'] = 'Data Pembelian Sarpras';\n            $user = PembelianSarpras::with('users', 'jenis_kebutuhans')\n                ->get();\n            $data['result'] = $user->sortDesc();\n            return view('main.pembelian_sarpras.index', $data);\n        }\n    }\n\n    /**\n     * Show the form for creating a new resource.\n     */\n    public function create()\n    {\n        $data['user'] = User::all();\n        $data['jenis_kebutuhan'] = JenisKebutuhan::all();\n        $data['title'] = \"Tambah Data Sarpras\";\n        return view(\"main.pembelian_sarpras.create\", $data);\n    }\n\n    /**\n     * Store a newly created resource in storage.\n     */\n    public function store(Request $request)\n    {\n        $request->validate([\n            'file1' => 'required|mimes:jpg,png|max:5048',\n            'file2' => 'required|mimes:jpg,png|max:5048',\n            'file3' => 'required|mimes:jpg,png|max:5048',\n            'user_id' => 'required',\n            'nama' => 'required',\n            'jenis_kebutuhan' => 'required',\n            'spesifikasi' => 'required',\n            'jumlah' => 'required',\n            'harga_satuan' => 'required',\n            'status' => 'required',\n            'tanggal' => 'required',\n        ]);\n        // Proses pengunggahan berkas pertama\n        $file1 = $request->file('file1');\n        $file1Name = time() . '_' . $file1->getClientOriginalName();\n        $file1->move(public_path('uploads'), $file1Name);\n\n        // Proses pengunggahan berkas kedua\n        $file2 = $request->file('file2');\n        $file2Name = time() . '_' . $file2->getClientOriginalName();\n        $file2->move(public_path('uploads'), $file2Name);\n\n        // Proses pengunggahan berkas ketiga\n        $file3 = $request->file('file3');\n        $file3Name = time() . '_' . $file3->getClientOriginalName();\n        $file3->move(public_path('uploads'), $file3Name);\n\n        $fileModel = new PembelianSarpras();\n\n        $fileModel->user_id = $request->user_id;\n        $fileModel->nama = $request->nama;\n        $fileModel->jenis_kebutuhan = $request->jenis_kebutuhan;\n        $fileModel->spesifikasi = $request->spesifikasi;\n        $fileModel->jumlah = $request->jumlah;\n        $fileModel->harga_satuan = $request->harga_satuan;\n        $fileModel->status = $request->status;\n        $fileModel->tanggal = $request->tanggal;\n        $fileModel->gambar_katalog = $file1Name;\n        $fileModel->paraf_kapokja = $file2Name;\n        $fileModel->gambar_pembelian = $file3Name;\n\n        $fileModel->save();\n        return redirect('main/pembelian_sarpras')->with('success', 'Data berhasil di simpan.');\n    }\n\n    /**\n     * Display the specified resource.\n     */\n    public function show(string $id)\n    {\n\n        $row = PembelianSarpras::findOrFail($id);\n        return view('main.pembelian_sarpras.show', [\n            'title' => 'Detail Data Pembelian Sarpras',\n            'nama' => $row->nama,\n            'jenis_kebutuhan' => $row->jenis_kebutuhan,\n            'spesifikasi' => $row->spesifikasi,\n            'jumlah' => $row->jumlah,\n            'harga_satuan' => $row->harga_satuan,\n            'gambar_katalog' => $row->gambar_katalog,\n            'paraf_kapokja' => $row->paraf_kapokja,\n            'gambar_pembelian' => $row->gambar_pembelian,\n        ]);\n    }\n\n    /**\n     * Show the form for editing the specified resource.\n     */\n    public function edit(string $id)\n    {\n\n        $row = PembelianSarpras::findOrFail($id);\n        $user = User::all();\n        $jenis_kebutuhan = JenisKebutuhan::all();\n        return view('main.pembelian_sarpras.edit', [\n            'title' => 'Edit Data Sarpras',\n            'user' => $user,\n            'id' => $row->id,\n            'nama' => $row->nama,\n            'jenis_kebutuhan' => $jenis_kebutuhan,\n            'spesifikasi' => $row->spesifikasi,\n            'jumlah' => $row->jumlah,\n            'harga_satuan' => $row->harga_satuan,\n            'status' => $row->status,\n            'tanggal' => $row->tanggal,\n        ]);\n    }\n\n    /**\n     * Update the specified resource in storage.\n     */\n    public function update(Request $request, string $id)\n    {\n        $request->validate([\n            // 'file1' => 'required|mimes:jpg,png|max:5048',\n            // 'file2' => 'required|mimes:jpg,png|max:5048',\n            // 'file3' => 'required|mimes:jpg,png|max:5048',\n            'user_id' => 'required',\n            'nama' => 'required',\n            'jenis_kebutuhan' => 'required',\n            'spesifikasi' => 'required',\n            'jumlah' => 'required',\n            'harga_satuan' => 'required',\n            'status' => 'required',\n            'tanggal' => 'required',\n        ]);\n        // // Proses pengunggahan berkas pertama\n        // $file1 = $request->file('file1');\n        // $file1Name = time() . '_' . $file1->getClientOriginalName();\n        // $file1->move(public_path('uploads'), $file1Name);\n\n        // // Proses pengunggahan berkas kedua\n        // $file2 = $request->file('file2');\n        // $file2Name = time() . '_' . $file2->getClientOriginalName();\n        // $file2->move(public_path('uploads'), $file2Name);\n\n        // // Proses pengunggahan berkas ketiga\n        // $file3 = $request->file('file3');\n        // $file3Name = time() . '_' . $file3->getClientOriginalName();\n        // $file3->move(public_path('uploads'), $file3Name);\n\n        $fileModel = PembelianSarpras::find($id);\n        $fileModel->user_id = $request->user_id;\n        $fileModel->nama = $request->nama;\n        $fileModel->jenis_kebutuhan = $request->jenis_kebutuhan;\n        $fileModel->spesifikasi = $request->spesifikasi;\n        $fileModel->jumlah = $request->jumlah;\n        $fileModel->harga_satuan = $request->harga_satuan;\n        $fileModel->status = $request->status;\n        $fileModel->tanggal = $request->tanggal;\n        // $fileModel->gambar_katalog = $file1Name;\n        // $fileModel->paraf_kapokja = $file2Name;\n        // $fileModel->gambar_pembelian = $file3Name;\n\n        $fileModel->save();\n\n        return redirect('main/pembelian_sarpras')->with('success', 'Data berhasil diubah');\n    }\n\n    /**\n     * Remove the specified resource from storage.\n     */\n    public function destroy(string $id)\n    {\n\n        $data = PembelianSarpras::findOrFail($id);\n        $image_path = \"/uploads/\" . $data->paraf_kapokja;\n        $gambar_katalog = \"/uploads/\" . $data->gambar_katalog;\n        $gambar_pembelian = \"/uploads/\" . $data->gambar_pembelian;\n\n        if (file_exists($image_path)) {\n            @unlink($image_path);\n            @unlink($gambar_katalog);\n            @unlink($gambar_pembelian);\n        }\n        $data->delete();\n        return back()->with('hapus', 'Data sudah di Hapus!');\n    }\n}\n"
        }
    ]
}